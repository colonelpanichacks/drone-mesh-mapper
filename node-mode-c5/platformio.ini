; =============================================================================
; Drone Mesh Mapper - Node Mode Firmware (XIAO ESP32-C5)
; colonelpanichacks
;
; Two build targets from the same project:
;   pio run -e remote_node   -> Detection node (WiFi+BLE drone scanning)
;   pio run -e home_node     -> Home receiver (UART bridge from Heltec mesh)
;
; Target: Seeed XIAO ESP32-C5 (RISC-V, WiFi 6 dual-band, BLE 5)
; Paired with a Heltec V3 (Meshtastic) via UART on D4/D5 pads
; =============================================================================

[platformio]
default_envs = remote_node, home_node

; -- Shared settings ----------------------------------------------------------
[env]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip
board = seeed_xiao_esp32c5
framework = arduino

build_flags =
    -std=gnu++17
    -DCORE_DEBUG_LEVEL=0

board_build.partitions = partitions.csv

monitor_speed = 115200
upload_speed = 115200

; -----------------------------------------------------------------------------
; REMOTE NODE - Detects drones via WiFi 6 + BLE 5, sends JSON to Heltec V3
; -----------------------------------------------------------------------------
[env:remote_node]
build_flags =
    ${env.build_flags}
    -DREMOTE_NODE
    -DCONFIG_BT_NIMBLE_ENABLED=1

; Compile remote main + ODID libraries, exclude home main
build_src_filter = +<*> -<main_home.cpp>

lib_deps =
    h2zero/NimBLE-Arduino@^2.1.0

; -----------------------------------------------------------------------------
; HOME NODE - Receives mesh JSON from Heltec V3, forwards over USB serial
; No WiFi, no BLE, no detection - pure UART-to-USB bridge with dedup
; -----------------------------------------------------------------------------
[env:home_node]
build_flags =
    ${env.build_flags}
    -DHOME_NODE

; Only compile the home node main
build_src_filter = -<*> +<main_home.cpp>
